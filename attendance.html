<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Attendance QR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<style>
*{
  box-sizing:border-box;
}

body{
  margin:0;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  font-family:Segoe UI;
  text-align:center;
  color:#fff;

  /* ðŸ–¼ DESKTOP BACKGROUND IMAGE */
  background:
    linear-gradient(rgba(0,0,0,0.65), rgba(0,0,0,0.65)),
    url("att.jpg") no-repeat center/cover;
}

h2{
  margin-bottom:20px;
}

input{
  width:280px;
  padding:12px;
  margin:10px 0;
  border-radius:10px;
  border:none;
  font-size:15px;
}

/* ðŸ”µ ONLY QR BUTTON STYLE */
.qr-btn{
  margin-top:22px;
  width:78px;
  height:78px;
  border-radius:50%;
  background:transparent;
  border:4px solid #ff9800;
  color:#ff9800;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  overflow:visible;
}

.qr-btn::after{
  content:"";
  position:absolute;
  inset:-12px;
  border-radius:50%;
  border:3px solid rgba(255,152,0,.55);
  animation:pulse 1.8s ease-out infinite;
}

@keyframes pulse{
  0%{ transform:scale(.85); opacity:1; }
  100%{ transform:scale(1.35); opacity:0; }
}

.qr-btn:hover{
  border-color:#ffb74d;
  color:#ffb74d;
}

/* QR box */
#qrcode{
  margin-top:30px;
  display:flex;
  justify-content:center;
}

.qr-box{
  background:#fff;
  padding:16px;
  border-radius:14px;
  border:3px solid #000;
}

/* ===== SAME MEDIA BACK BUTTON ===== */
.back-btn{
  position:fixed;
  top:20px;
  right:22px;
  padding:8px 18px;
  border:none;
  border-radius:25px;
  font-weight:bold;
  font-size:14px;
  cursor:pointer;
  color:#fff;
  background:linear-gradient(135deg,#ffeb3b,#ff9800,#ff5722);
  box-shadow:0 4px 15px rgba(0,0,0,0.5);
  transition:all .3s ease;
  z-index:999;
}

.back-btn:hover{
  transform:scale(1.08);
  box-shadow:0 6px 20px rgba(0,0,0,0.7);
}

/* Mobile */
@media (max-width: 600px){

  body{
    background:
      linear-gradient(rgba(0,0,0,0.65), rgba(0,0,0,0.65)),
      url("att_mob.jpg") no-repeat center/cover;

    justify-content:flex-start;
    padding:24px 12px;
  }

  h2{
    font-size:20px;
    margin-top:10px;
  }

  input{
    width:100%;
    max-width:320px;
    font-size:16px;
    padding:14px;
  }

  .qr-btn{
    width:70px;
    height:70px;
  }

  #qrcode{
    margin-top:24px;
  }

  .back-btn{
    top:15px;
    right:15px;
    font-size:13px;
  }
}
</style>
</head>

<body>

<button class="back-btn" onclick="goBack()">Back</button>

<h2>Generate Attendance QR</h2>

<input type="date" id="date">
<input id="meeting" placeholder="Meeting Name">

<button class="qr-btn" onclick="generateQR()">QR</button>

<div id="qrcode"></div>

<script>
  const role = sessionStorage.getItem("role");
const permissions = sessionStorage.getItem("permissions") || "";

if (!role) {
  window.location.href = "index.html";
}

/* Allow only admin, superadmin OR user with media permission */
if (role === "user" && !permissions.includes("attendance")) {
  window.location.href = "dashboard.html";
}
function goBack(){
  window.location.href="dashboard.html";
}

function generateQR(){
  const date=document.getElementById("date").value;
  const meeting=document.getElementById("meeting").value;

  if(!date || !meeting){
    alert("Enter date & meeting name");
    return;
  }

  const url="attendance-scan.html?date="+
            encodeURIComponent(date)+
            "&meeting="+
            encodeURIComponent(meeting);

  document.getElementById("qrcode").innerHTML=
    '<div class="qr-box" id="qr"></div>';

  new QRCode(document.getElementById("qr"),{
    text:url,
    width:260,
    height:260
  });
}

</script>

</body>
</html>