<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Media Upload</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{
  box-sizing:border-box;
}

body{
  margin:0;
  padding:40px 20px;
  font-family:Segoe UI,sans-serif;
  color:#fff;
  min-height:100vh;

  /* ðŸ’» DESKTOP BACKGROUND */
  background:
    linear-gradient(rgba(0,0,0,0.65), rgba(0,0,0,0.65)),
    url("media.jpg") no-repeat center/cover;
}

/* ===== PREMIUM BACK BUTTON ===== */
.back-btn{
  position:fixed;
  top:20px;
  right:22px;
  padding:8px 18px;
  border:none;
  border-radius:25px;
  font-weight:bold;
  font-size:14px;
  cursor:pointer;
  color:#fff;
  background:linear-gradient(135deg,#ffeb3b,#ff9800,#ff5722);
  box-shadow:0 4px 15px rgba(0,0,0,0.5);
  transition:all .3s ease;
  z-index:999;
}

.back-btn:hover{
  transform:scale(1.08);
  box-shadow:0 6px 20px rgba(0,0,0,0.7);
}

/* ===== TITLE ===== */
h2{
  text-align:center;
  margin-bottom:30px;
}

/* ===== FORM ===== */
.form-group{
  max-width:600px;
  margin:0 auto 20px auto;
}

label{
  display:block;
  margin-bottom:6px;
  font-size:15px;
}

input{
  width:100%;
  padding:12px 16px;
  border-radius:12px;
  border:none;
  background:rgba(255,255,255,0.12);
  color:#fff;
  outline:none;
  font-size:14px;
}

input[type=file]{
  padding:8px;
}

/* ===== SAVE BUTTON ===== */
.save-btn{
  margin:30px auto 0 auto;
  display:block;
  width:260px;
  padding:12px;
  border:none;
  border-radius:25px;
  font-weight:bold;
  cursor:pointer;
  background:linear-gradient(135deg,#ffeb3b,#ff5722);
}

/* ===== WAVY LOADER ===== */
.loader-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.75);
  backdrop-filter:blur(6px);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999;
}

.wave-loader{
  display:flex;
  gap:8px;
}

.wave-loader span{
  width:10px;
  height:40px;
  border-radius:20px;
  background:linear-gradient(180deg,#ffeb3b,#ff5722);
  animation:wave 1s infinite ease-in-out;
}

.wave-loader span:nth-child(2){ animation-delay:0.1s; }
.wave-loader span:nth-child(3){ animation-delay:0.2s; }
.wave-loader span:nth-child(4){ animation-delay:0.3s; }
.wave-loader span:nth-child(5){ animation-delay:0.4s; }

@keyframes wave{
  0%,100%{ transform:scaleY(0.4); }
  50%{ transform:scaleY(1.2); }
}

/* ================= MOBILE VIEW ================= */
@media (max-width:768px){

body{
  padding:30px 15px;

  /* ðŸ“± MOBILE BACKGROUND */
  background:
    linear-gradient(rgba(0,0,0,0.75), rgba(0,0,0,0.75)),
    url("media_mob.png") no-repeat center/cover;
}

.form-group{
  max-width:95%;
}

input{
  width:100%;
  font-size:16px; /* prevent iPhone zoom */
}

.save-btn{
  width:100%;
}

.back-btn{
  top:15px;
  right:15px;
  font-size:13px;
}

}

</style>
</head>

<body>

<button class="back-btn" onclick="goBack()">Back</button>

<h2>Media Upload</h2>

<div class="form-group">
  <label>Select Date</label>
  <input type="date" id="date">
</div>

<div class="form-group">
  <label>Event Name</label>
  <input type="text" id="eventName" placeholder="Enter event name">
</div>

<div class="form-group">
  <label>Upload Images (Max 20)</label>
  <input type="file" id="images" multiple accept="image/*">
</div>

<button class="save-btn" onclick="uploadMedia()">Upload</button>

<!-- WAVY LOADER -->
<div class="loader-overlay" id="loader">
  <div class="wave-loader">
    <span></span><span></span><span></span><span></span><span></span>
  </div>
</div>

<script>
const role = sessionStorage.getItem("role");
const permissions = sessionStorage.getItem("permissions") || "";

if (!role) {
  window.location.href = "index.html";
}

/* Allow only admin, superadmin OR user with media permission */
if (role === "user" && !permissions.includes("media")) {
  window.location.href = "dashboard.html";
}
const API_URL = "https://script.google.com/macros/s/AKfycbzOLVmw7KAZ4TJWow4BV4JfZnXqp8aBI83N4c55Wca2rkGRj25y29xklPRb-a-iMYQL/exec";

function goBack(){
  window.location.href="dashboard.html";
}

function showLoader(){
  document.getElementById("loader").style.display="flex";
}

function hideLoader(){
  document.getElementById("loader").style.display="none";
}

function uploadMedia(){

  const dateInput=document.getElementById("date");
  const eventInput=document.getElementById("eventName");
  const fileInput=document.getElementById("images");

  const date=dateInput.value;
  const event=eventInput.value;
  const files=fileInput.files;

  if(!date || !event){
    alert("Fill all fields");
    return;
  }

  if(files.length===0){
    alert("Select images");
    return;
  }

  if(files.length>20){
    alert("Maximum 20 images allowed");
    return;
  }

  showLoader();

  const readerPromises=[];

  for(let file of files){
    readerPromises.push(
      new Promise(resolve=>{
        const reader=new FileReader();
        reader.onload=e=>resolve({
          name:file.name,
          type:file.type,
          data:e.target.result.split(",")[1]
        });
        reader.readAsDataURL(file);
      })
    );
  }

  Promise.all(readerPromises).then(images=>{

    fetch(API_URL,{
      method:"POST",
      body:JSON.stringify({
        action:"uploadMedia",
        date:date,
        event:event,
        images:images
      })
    })
    .then(res=>res.json())
    .then(data=>{
      hideLoader();

      if(data.success){
        alert("Upload Successful âœ…");

        /* Reset fields */
        dateInput.value="";
        eventInput.value="";
        fileInput.value="";
      }else{
        alert("Upload failed");
      }
    })
    .catch(()=>{
      hideLoader();
      alert("Upload error");
    });

  });
}

</script>

</body>
</html>