<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6));
  font-family:Segoe UI,sans-serif;
  color:#fff;
}

/* PROFILE CARD */
.container{
  max-width:420px;
  margin:30px auto;
  background:rgba(255,255,255,.15);
  backdrop-filter:blur(14px);
  border-radius:18px;
  padding:22px;
}

input{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
  border:none;
}
input[readonly]{background:#ddd}

button{
  width:100%;
  margin-top:14px;
  padding:12px;
  border:none;
  border-radius:25px;
  background:linear-gradient(135deg,#ffeb3b,#ff5722);
  font-weight:bold;
  cursor:pointer;
}

#msg{text-align:center;margin-top:10px}

/* ============================= */
/* üîí FREEZE OVERLAY + LOADER   */
/* ============================= */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.35);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:99999;
}

/* RED + YELLOW MIXED LOADER */
.loader span{
  display:inline-block;
  width:7px;
  height:28px;
  margin:0 4px;
  border-radius:4px;
  background:linear-gradient(180deg,#ffeb3b,#ff0000);
  animation:pulse 1s infinite ease-in-out;
}

.loader span:nth-child(1){animation-delay:0s}
.loader span:nth-child(2){animation-delay:.1s}
.loader span:nth-child(3){animation-delay:.2s}
.loader span:nth-child(4){animation-delay:.3s}

@keyframes pulse{
  0%,100%{transform:scaleY(.5);opacity:.6}
  50%{transform:scaleY(1.3);opacity:1}
}
/* ================= MOBILE VIEW ONLY ================= */
@media screen and (max-width: 600px) {

  /* üì± Mobile background */
  body{
    background:
      linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)),
      url("profile_mob.jpg") no-repeat center/cover !important;

    padding:16px 12px 30px !important;
  }

  /* ‚ùå KILL CONTAINER CARD COMPLETELY */
  .container{
    background:transparent !important;
    backdrop-filter:none !important;
    box-shadow:none !important;
    border-radius:0 !important;

    width:100% !important;
    max-width:100% !important;
    margin:0 auto !important;
    padding:0 !important;

    display:flex !important;
    flex-direction:column !important;
    align-items:center !important;
  }

  /* üìù Title */
  .container h2{
    width:100% !important;
    text-align:center !important;
    font-size:20px !important;
    margin-bottom:12px !important;
  }

  /* ‚å® ALL INPUTS ‚Äî SAME ALIGNMENT */
  .container input{
    width:320px !important;        /* üî• SAME WIDTH */
    max-width:100% !important;
    box-sizing:border-box !important;

    font-size:16px !important;     /* iPhone zoom fix */
    padding:14px !important;
    border-radius:14px !important;

    margin:8px 0 !important;
    display:block !important;
  }

  input[readonly]{
    background:#ccc !important;
  }

  /* üìÅ File inputs */
  .container input[type="file"]{
    background:#fff !important;
    color:#000 !important;
    padding:10px !important;
  }

  /* üîò Save button ‚Äî aligned with inputs */
  .container button{
    width:320px !important;
    max-width:100% !important;
    height:48px !important;
    border-radius:26px !important;
    font-size:15px !important;

    margin:18px 0 0 !important;
  }

  /* ‚Ñπ Message */
  #msg{
    width:100% !important;
    text-align:center !important;
    font-size:14px !important;
    margin-top:10px !important;
  }
}
</style>
</head>

<body>

<!-- üîí PAGE FREEZE + LOADER -->
<div id="overlay" class="overlay">
  <div class="loader">
    <span></span><span></span><span></span><span></span>
  </div>
</div>

<div class="container">
<h2>My Profile</h2>

<input id="mobile" readonly>
<input id="username" placeholder="Name *">
<input id="father" placeholder="Father Name *">
<input id="mother" placeholder="Mother Name *">
<input type="date" id="dob">
<input id="aadhaar" placeholder="Aadhaar Number *">
<input id="voter" placeholder="Voter ID *">
<input id="email" placeholder="Email">
<input id="team" placeholder="Team *">
<input id="posting" placeholder="Posting *">
<input id="qualification" placeholder="Qualification *">
<input id="education" placeholder="Education *">
<input id="religion" placeholder="Religion">
<input id="caste" placeholder="Caste">

<input type="file" id="aadhaarImg">
<input type="file" id="voterImg">
<input type="file" id="memberImg">
<input type="file" id="profileImg">

<button onclick="saveProfile()">Save Profile</button>
<div id="msg"></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzOLVmw7KAZ4TJWow4BV4JfZnXqp8aBI83N4c55Wca2rkGRj25y29xklPRb-a-iMYQL/exec";

/* üîí FREEZE PAGE */
function showLoader(){
  document.getElementById("overlay").style.display="flex";
  document.body.style.overflow="hidden";
}
function hideLoader(){
  document.getElementById("overlay").style.display="none";
  document.body.style.overflow="";
}

/* BASE64 */
function toBase64(file){
  return new Promise(r=>{
    const fr=new FileReader();
    fr.onload=()=>r(fr.result);
    fr.readAsDataURL(file);
  });
}

/* LOAD PROFILE */
const mobile=sessionStorage.getItem("mobile");
document.getElementById("mobile").value=mobile;

fetch(API_URL,{
  method:"POST",
  headers:{ "Content-Type":"text/plain" },
  body:JSON.stringify({ action:"getProfile", mobile })
})
.then(r=>r.json())
.then(d=>{
  if(d.success){
    Object.keys(d.profile).forEach(k=>{
      if(document.getElementById(k))
        document.getElementById(k).value=d.profile[k];
    });
  }
});

/* SAVE PROFILE */
async function saveProfile(){
  showLoader();

  const payload={
    action:"saveProfile",
    mobile,
    username: username.value,
    father: father.value,
    mother: mother.value,
    dob: dob.value,
    aadhaar: aadhaar.value,
    voter: voter.value,
    email: email.value,
    team: team.value,
    posting: posting.value,
    qualification: qualification.value,
    education: education.value,
    religion: religion.value,
    caste: caste.value,
    aadhaarImg: aadhaarImg.files[0]?await toBase64(aadhaarImg.files[0]):"",
    voterImg: voterImg.files[0]?await toBase64(voterImg.files[0]):"",
    memberImg: memberImg.files[0]?await toBase64(memberImg.files[0]):"",
    profileImg: profileImg.files[0]?await toBase64(profileImg.files[0]):""
  };

  fetch(API_URL,{
    method:"POST",
    headers:{ "Content-Type":"text/plain" },
    body:JSON.stringify(payload)
  })
  .then(r=>r.json())
  .then(d=>{
    hideLoader();
    if(d.success){
      setTimeout(()=>location.href="dashboard.html",1000);
    }else{
      alert(d.message);
    }
  })
  
  .catch(()=>{
    hideLoader();
    alert("Server error");
  });
}
</script>

</body>
</html>