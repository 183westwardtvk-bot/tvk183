<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ff9800">
<meta charset="UTF-8">
<title>View Users</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  min-height:100vh;
  background:
    linear-gradient(rgba(0,0,0,.65),rgba(0,0,0,.65)),
    url("userlist.jpg") no-repeat center / cover;
  font-family:Segoe UI,sans-serif;
  color:#fff;
}

/* ===== HEADER ===== */
.header{
  text-align:center;
  padding:18px;
  font-size:22px;
  font-weight:600;
}

/* ===== LIST ===== */
.list{
  max-width:1000px;
  margin:0 auto 30px;
  padding:0 16px;
}

.user-row{
  background:rgba(255,255,255,.12);
  border-radius:14px;
  padding:14px 16px;
  margin-bottom:14px;
}

.row-top{
  display:grid;
  grid-template-columns:60px 1fr 1fr 1fr auto;
  gap:12px;
  align-items:center;
}

.avatar{
  width:52px;
  height:52px;
  border-radius:50%;
  object-fit:cover;
  border:2px solid #ffeb3b;
  background:#333;
}

.label{font-size:12px;opacity:.75}
.value{font-size:15px;font-weight:600}

.more-btn{
  padding:6px 14px;
  border:none;
  border-radius:18px;
  background:linear-gradient(135deg,#ffeb3b,#ff5722);
  font-weight:600;
  cursor:pointer;
}

.details{
  display:none;
  margin-top:14px;
  background:rgba(0,0,0,.35);
  border-radius:12px;
  padding:14px;
}

.details-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:10px;
}

.details-item{font-size:14px}

/* ============================= */
/* ðŸ”¥ LOADER OVERLAY (NEW)      */
/* ============================= */
#loaderOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:99999;
}

.wave-loader span{
  display:inline-block;
  width:8px;
  height:32px;
  margin:0 4px;
  border-radius:4px;
  background:linear-gradient(180deg,#ffeb3b,#ff0000);
  animation:wave 1.1s infinite ease-in-out;
}

.wave-loader span:nth-child(1){animation-delay:0s}
.wave-loader span:nth-child(2){animation-delay:.1s}
.wave-loader span:nth-child(3){animation-delay:.2s}
.wave-loader span:nth-child(4){animation-delay:.3s}
.wave-loader span:nth-child(5){animation-delay:.4s}

@keyframes wave{
  0%,100%{transform:scaleY(.4);opacity:.5}
  50%{transform:scaleY(1.4);opacity:1}
}
/* ===== PREMIUM BACK BUTTON ===== */
.back-btn{
  position:fixed;
  top:20px;
  right:22px;
  padding:8px 18px;
  border:none;
  border-radius:25px;
  font-weight:bold;
  font-size:14px;
  cursor:pointer;
  color:#fff;
  background:linear-gradient(135deg,#ffeb3b,#ff9800,#ff5722);
  box-shadow:0 4px 15px rgba(0,0,0,0.5);
  transition:all .3s ease;
  z-index:999;
}

.back-btn:hover{
  transform:scale(1.08);
  box-shadow:0 6px 20px rgba(0,0,0,0.7);
}
/* ================= MOBILE VIEW ONLY ================= */
@media (max-width: 600px) {

  /* ðŸ“± Separate mobile background */
  body{
    background:
      linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)),
      url("view_mob.jpg") no-repeat center/cover;

    padding-top:70px;   /* âœ… Prevent overlap */
  }

  /* ðŸ”™ Back button adjust */
  .back-btn{
    top:15px;
    right:15px;
    font-size:13px;
    padding:6px 16px;
  }

  /* Header */
  .header{
    font-size:18px;
    padding:14px 10px;
  }

  .list{
    padding:0 10px 24px;
  }

  .user-row{
    padding:12px;
    border-radius:12px;
  }

  /* ðŸ”¥ FIX OVERLAP: switch to FLEX */
  .row-top{
    display:flex;
    align-items:flex-start;
    gap:10px;
  }

  /* Avatar */
  .avatar{
    width:46px;
    height:46px;
    flex-shrink:0;
  }

  .row-top > div{
    width:100%;
  }

  .row-top > div:not(.avatar){
    display:flex;
    flex-direction:column;
    gap:6px;
  }

  .label{
    font-size:11px;
  }

  .value{
    font-size:14px;
    white-space:normal;
    word-break:break-word;
  }

  .more-btn{
    margin:10px auto 0;
    display:block;
  }

  .details-grid{
    grid-template-columns:1fr;
    gap:8px;
  }

  .details-item{
    font-size:13px;
  }
}
</style>
</head>

<body>
<button class="back-btn" onclick="goBack()">â¬… Back</button>
<!-- ðŸ”¥ LOADER -->
<div id="loaderOverlay">
  <div class="wave-loader">
    <span></span><span></span><span></span><span></span><span></span>
  </div>
</div>

<div class="header">User List</div>
<div class="list" id="userList">Loading...</div>

<script>
function goBack(){
  window.location.href = "userdata.html";
}
const role = sessionStorage.getItem("role");

if (!role) {
    window.location.href = "index.html";
}
const API_URL = "https://script.google.com/macros/s/AKfycbzOLVmw7KAZ4TJWow4BV4JfZnXqp8aBI83N4c55Wca2rkGRj25y29xklPRb-a-iMYQL/exec";

/* IMAGE FIX */
function driveToImg(url){
  if(!url) return "";
  let m = url.match(/\/d\/([^\/]+)/) || url.match(/id=([^&]+)/);
  return m ? "https://drive.google.com/thumbnail?id=" + m[1] + "&sz=w400" : url;
}

fetch(API_URL,{
  method:"POST",
  headers:{ "Content-Type":"text/plain" },
  body:JSON.stringify({ action:"getAllUsers" })
})
.then(r=>r.json())
.then(d=>{
  document.getElementById("loaderOverlay").style.display="none";

  if(!d.success){
    document.getElementById("userList").innerText="No users found";
    return;
  }

  const box = document.getElementById("userList");
  box.innerHTML = "";

  d.users.forEach((u,i)=>{
    const imgUrl = driveToImg(u.profileImg);
    const div = document.createElement("div");
    div.className = "user-row";

    div.innerHTML = `
      <div class="row-top">
        <img class="avatar" src="${imgUrl}"
          referrerpolicy="no-referrer"
          onerror="this.src='https://via.placeholder.com/100'">

        <div><div class="label">Name</div><div class="value">${u.name||"-"}</div></div>
        <div><div class="label">Mobile</div><div class="value">${u.mobile||"-"}</div></div>
        <div><div class="label">Voter ID</div><div class="value">${u.voter||"-"}</div></div>

        <button class="more-btn" onclick="toggle(${i})">More</button>
      </div>

      <div class="details" id="details${i}">
        <div class="details-grid">
          <div class="details-item"><b>Father:</b> ${u.father||"-"}</div>
          <div class="details-item"><b>Mother:</b> ${u.mother||"-"}</div>
          <div class="details-item"><b>DOB:</b> ${u.dob||"-"}</div>
          <div class="details-item"><b>Aadhaar:</b> ${u.aadhaar||"-"}</div>
          <div class="details-item"><b>Email:</b> ${u.email||"-"}</div>
          <div class="details-item"><b>Team:</b> ${u.team||"-"}</div>
          <div class="details-item"><b>Posting:</b> ${u.posting||"-"}</div>
          <div class="details-item"><b>Qualification:</b> ${u.qualification||"-"}</div>
          <div class="details-item"><b>Education:</b> ${u.education||"-"}</div>
          <div class="details-item"><b>Religion:</b> ${u.religion||"-"}</div>
          <div class="details-item"><b>Caste:</b> ${u.caste||"-"}</div>
        </div>
      </div>
    `;
    box.appendChild(div);
  });
})
.catch(()=>{
  document.getElementById("loaderOverlay").style.display="none";
  document.getElementById("userList").innerText="Server error";
});

function toggle(i){
  const el=document.getElementById("details"+i);
  el.style.display = el.style.display==="block" ? "none" : "block";
}
</script>

</body>
</html>